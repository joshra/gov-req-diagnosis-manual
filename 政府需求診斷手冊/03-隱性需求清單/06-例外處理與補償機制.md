# 例外處理與補償機制

## 這一章在解什麼
系統上線後真正的日常是「失敗與例外」。沒有設計補償機制，結果就是：
- 工程師手動改資料
- 資料對不起來
- 每次事故都靠人記憶處理

## 會議回應示例
「我們先把失敗情境列出來：哪些可以自動重試、哪些要人工介入、要不要對帳、要不要補送。把補償機制做到可操作，維運才不會每天救火。」

## 例外分類（建議直接採用）
- **可重試**：暫時性網路錯誤、對方短暫不可用
- **不可重試**：資料格式錯、缺必填欄位、權限不足
- **需要人工介入**：邏輯矛盾、重複資料、跨系統不一致

## 必備機制清單
- **重試策略**：次數、間隔、退避、何時停止
- **死信匣/失敗佇列**：保留失敗訊息，避免直接丟失
- **批次ID與回放**：可針對某批資料重跑/補送
- **對帳**：來源數量 vs 落地數量 vs 報表數量
- **人工更正流程**：更正單/調整單＋稽核留痕（不允許直接改掉）

## 驗收建議
- 指定 5 種失敗案例：斷線、超時、格式錯、重複、權限不足
- 每種都要能：看得到原因、可重試/可補送/可人工處理、結果可追溯

## 常見坑
- 沒有對帳 → 資料錯了很久才發現
- 允許直接改資料 → 之後無法追溯與稽核
